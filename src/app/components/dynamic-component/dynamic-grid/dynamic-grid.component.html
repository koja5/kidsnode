<div *ngIf="loader" style="height: 70vh">
  <app-loader></app-loader>
</div>
<div *ngIf="!loader" #container>
  <ejs-grid
    #grid
    *ngIf="config"
    width="100%"
    [height]="height"
    [dataSource]="data"
    [editSettings]="config.editSettings"
    [toolbar]="config.toolbar"
    [allowSorting]="config?.sorting?.enable"
    [sortSettings]="config?.sorting?.initialSorting"
    [allowGrouping]="config.grouping.enable"
    [allowResizing]="config.allowResizing"
    [allowPaging]="config.paging.enable"
    [allowExcelExport]="true"
    [allowPdfExport]="true"
    [pageSettings]="config.paging.settings"
    [allowFiltering]="config.filtering.enable"
    [contextMenuItems]="config.contextMenuItems"
    (actionComplete)="actionComplete($event)"
  >
    <e-columns>
      <e-column
        *ngFor="let item of config.columns; let i = index"
        [type]="item.type"
        [field]="item.field"
        [headerText]="language[item.title] ? language[item.title] : item.title"
        [width]="item.width"
        [class]="item?.class"
        [textAlign]="item?.position"
        [isPrimaryKey]="item.isPrimaryKey"
        [editType]="item.editType ? item.editType : null"
        [allowEditing]="item.allowEditing"
        [format]="item.format"
        [validationRules]="item.validation"
      >
        <ng-template #template let-data *ngIf="item?.template">
          <div *ngIf="item.template.type === 'button'">
            <button
              [class]="item.template.class"
              *ngIf="item.template.action === 'open'"
              (click)="
                openPage(item.template.link, item.template.parameters, data)
              "
            >
              <mat-icon
                class="mat-icon notranslate material-icons mat-icon-no-color"
                aria-hidden="false"
                *ngIf="item.template.classIcon"
                >{{ item.template.classIcon }}</mat-icon
              >
              <span *ngIf="item.template.label">{{ item.template.label }}</span>
            </button>
          </div>
        </ng-template>
      </e-column>
    </e-columns>

    <ng-template #editSettingsTemplate let-data>
      <div ngForm>
        <div class="form-row">
          <app-dynamic-forms
            [config]="config"
            (submit)="submitEmitter($event)"
            #form="dynamicForm"
          >
          </app-dynamic-forms>
        </div>
      </div>
    </ng-template>
  </ejs-grid>
</div>
